<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Bi-Directional Authentication with TOTP | Juniperspring</title>
<meta name="keywords" content="mfa, security, totp, cryptography">
<meta name="description" content="Authentication is a two-way street.">
<meta name="author" content="Eric McDonald">
<link rel="canonical" href="https://juniperspring.xyz/posts/bidirectional-totp/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.e42a4f532c97e8fad5e0556de3cf192552a8c5b7bd42bd3034f55b4b3d96edc8.css" integrity="sha256-5CpPUyyX6PrV4FVt488ZJVKoxbe9Qr0wNPVbSz2W7cg=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://juniperspring.xyz/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://juniperspring.xyz/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://juniperspring.xyz/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://juniperspring.xyz/apple-touch-icon.png">
<link rel="mask-icon" href="https://juniperspring.xyz/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><script async defer data-domain="juniperspring.xyz" src="https://plausible.io/js/plausible.js"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css"
    integrity="sha384-3UiQGuEI4TTMaFmGIZumfRPtfKQ3trwQE2JgosJxCnGmQpL/lJdjpcHkaaFwHlcI" crossorigin="anonymous">

<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js"
    integrity="sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t"
    crossorigin="anonymous"></script>

<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js"
    integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous" onload="renderMathInElement(document.body, {
    delimiters: [
        {left: '$$', right: '$$', display: false},
        {left: '$', right: '$', display: false},
    ],
});"></script>
<meta property="og:title" content="Bi-Directional Authentication with TOTP" />
<meta property="og:description" content="Authentication is a two-way street." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://juniperspring.xyz/posts/bidirectional-totp/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-21T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-01-21T00:00:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Bi-Directional Authentication with TOTP"/>
<meta name="twitter:description" content="Authentication is a two-way street."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://juniperspring.xyz/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Bi-Directional Authentication with TOTP",
      "item": "https://juniperspring.xyz/posts/bidirectional-totp/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Bi-Directional Authentication with TOTP",
  "name": "Bi-Directional Authentication with TOTP",
  "description": "Authentication is a two-way street.",
  "keywords": [
    "mfa", "security", "totp", "cryptography"
  ],
  "articleBody": " Image sourced from Wikimedia, attributed according to the Creative Commons Attribution 2.0 Generic license.\nMotivation Time-Based One Time Password (TOTP) authentication is extremely beneficial. It lets you quickly add two‑factor authentication (2FA) to online accounts according to a simple and open standard. Simply scan a QR code into a TOTP app like Aegis. As long as you have access to your phone, you can then use the TOTP app to generate 2FA codes whenever need be. No risk of SIM swapping, no need for SMS reception or a phone number, and no need for proprietary 2FA apps.\nBut TOTP as it’s currently widely implemented has a shortcoming; it doesn’t prevent phishing attacks. Click a link in an email that redirects to a phishing website; the phishing website mimics one of your favorite websites. You think it’s the legitimate website, so you enter your username, password, and TOTP code. The attacker behind the phishing website now has everything they need to sign in to the legitimate website on your behalf without your consent. Even though you have TOTP‑based 2FA enabled, you can still be phished.\nThe Problem The problem in the above scenario is that authentication is only actually being done one way. Existing TOTP implementations allow users to authenticate to websites (think “I’m the website google.com, is this person really John Smith?”). Existing TOTP implementations don’t authenticate websites to users (think “I’m John Smith, is this website really google.com?”).\nBi-Directional Alternative Imagine the scenario where, in addition to asking you for your TOTP code (let’s call this z), a website also provided you with its own TOTP code (let’s call this z'). Within your authenticator app, you’d select the desired website from a list of stored websites. But rather than being shown a TOTP code right away (z), you’d be prompted for the TOTP code provided from the website (z').\nIf the website is a phishing website, they can’t produce valid TOTP codes z or z'. Your authenticator app would check that the TOTP code provided by the website (z') is valid. The legitimate website would check that the TOTP code provided by your authenticator app (z) is valid.\nIf the code z' is NOT valid, the authenticator app knows something is wrong, and would show a large error message indicating that you may be interacting with a phishing website. At this point, you could change your password on the legitimate site and report the phishing attempt.\nIf the code z' is valid, the authenticator app would provide you with the usual TOTP code z and you would sign in as usual. If the code z' is NOT valid, the authenticator app would never provide you with the TOTP code required by the legitimate website.\nBi-Directional Authentication in the RFC I mused over this for long enough that I exhausted the TOTP and HOTP Wikipedia articles and went on to read the RFCs. There are (at least) two main standards related to TOTP. RFC 4226 defines a more generic HMAC‑Based OTP algorithm (HOTP). RFC 6238 defines the TOTP algorithm based on the HOTP algorithm. On page 14 of RFC 4226, I found this gem:\nInterestingly enough, the HOTP client could also be used to\nauthenticate the validation server, claiming that it is a genuine\nentity knowing the shared secret.\nSince the HOTP client and the server are synchronized and share the\nsame secret (or a method to recompute it), a simple 3-pass protocol\ncould be put in place:\n1- The end user enter the TokenID and a first OTP value OTP1;\n2- The server checks OTP1 and if correct, sends back OTP2;\n3- The end user checks OTP2 using his HOTP device and if correct,\nuses the web site.\nIn other words, the writers of the HOTP RFC considered this as a possibility but nothing (as far as I know) ever came of it.\nImplementation Ideas I’ve come up with two back-of-the-envelope implementation ideas that seem like they’d work given minimal extension of the existing RFCs.\nThe Straightforward Way - Generate Two Keys The most straightforward way (in my opinion) to implement bi‑directional TOTP would be to generate two shared keys on a website for each new 2FA enrollment. Call these keys $$k, k’$$\nk would be used for (the usual) user‑to‑website authentication k' would be used for (the new) website‑to‑user authentication One drawback to this approach is that it includes the network transmission of k' during enrollment. Further, this requires storing k' for every 2FA enrollment, increasing storage costs.\nThe Simple(?) Way - Key Derivation Rather than generate a new key k' just for website-to-client authentication, it could be derived from K. For example, implementations could use a key derivation function such as Argon2 or PBKDF2, taking as inputs K and some salt which is fixed for the protocol.\nThe biggest advantages to this approach is that it negates the need for network transmission of k' upon enrollment. It also allows for finer-grained time/value tradeoffs to be made regarding when k' is derived and stored. The drawback is added complexity and an increased implementation attack surface.\nConclusion Bi‑directional authentication is only mentioned in the HOTP RFC, not the TOTP RFC. Neither RFC 4226 nor 6238 include the word “phishing” and they were published in 2005 and 2011, respectively. I would argue that, given that phishing attacks are still prevalent in 2023, we should revisit bi‑directional authentication in TOTP. I’d love to see a pull request to support this in one of the major open source TOTP implementations.\nAppendix: Accessibility TOTP limits accessibility by using short timeouts (30 seconds by default). Adding a second code implies a twofold increase in the amount of time required by a user to authenticate to a service. Further, TOTP codes aren’t intuitive to a non-technical audience. In my opinion, this is evidenced by a lack of wider adoption. Adding a second code to the mix only increases the potential for confusion.\nI understand the absence of a widely-implemented bi-directional TOTP standard in light of these constraints.\nAppendix: Phishing vs TOTP Timeouts Technically, because TOTP codes expire (by default) in 30 seconds, any phishing attack would have to prompt the user for their TOTP code, receive the response, and have it accepted by the legitimate website on behalf of the attacker within 30 seconds.\nIn practice, I don’t see this as a limiting factor in most phishing attacks. Also, specific TOTP code expiration times are an implementation detail; I don’t think they should be relied upon to prevent phishing attacks.\n",
  "wordCount" : "1085",
  "inLanguage": "en",
  "datePublished": "2023-01-21T00:00:00Z",
  "dateModified": "2023-01-21T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Eric McDonald"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://juniperspring.xyz/posts/bidirectional-totp/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Juniperspring",
    "logo": {
      "@type": "ImageObject",
      "url": "https://juniperspring.xyz/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://juniperspring.xyz" accesskey="h" title="Juniperspring🌱 (Alt + H)">Juniperspring🌱</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      Bi-Directional Authentication with TOTP
    </h1>
    <div class="post-description">
      Authentication is a two-way street.
    </div>
    <div class="post-meta"><span title='2023-01-21 00:00:00 +0000 UTC'>January 21, 2023</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;Eric McDonald

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#motivation" aria-label="Motivation">Motivation</a></li>
                <li>
                    <a href="#the-problem" aria-label="The Problem">The Problem</a></li>
                <li>
                    <a href="#bi-directional-alternative" aria-label="Bi-Directional Alternative">Bi-Directional Alternative</a></li>
                <li>
                    <a href="#bi-directional-authentication-in-the-rfc" aria-label="Bi-Directional Authentication in the RFC">Bi-Directional Authentication in the RFC</a></li>
                <li>
                    <a href="#implementation-ideas" aria-label="Implementation Ideas">Implementation Ideas</a><ul>
                        
                <li>
                    <a href="#the-straightforward-way---generate-two-keys" aria-label="The Straightforward Way - Generate Two Keys">The Straightforward Way - Generate Two Keys</a></li>
                <li>
                    <a href="#the-simple-way---key-derivation" aria-label="The Simple(?) Way - Key Derivation">The Simple(?) Way - Key Derivation</a></li></ul>
                </li>
                <li>
                    <a href="#conclusion" aria-label="Conclusion">Conclusion</a></li>
                <li>
                    <a href="#appendix-accessibility" aria-label="Appendix: Accessibility">Appendix: Accessibility</a></li>
                <li>
                    <a href="#appendix-phishing-vs-totp-timeouts" aria-label="Appendix: Phishing vs TOTP Timeouts">Appendix: Phishing vs TOTP Timeouts</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p><img loading="lazy" src="berlin-clock.jpg" alt="Mengenlehreuhr"  title="Mengenlehreuhr, Berlin"  />

Image sourced from <a href="https://commons.wikimedia.org/wiki/File:Berlin_-_Mengenlehreuhr_am_Europa-Center.jpg">Wikimedia</a>,
attributed according to the Creative Commons Attribution 2.0 Generic license.</p>
<h2 id="motivation">Motivation<a hidden class="anchor" aria-hidden="true" href="#motivation">#</a></h2>
<p>Time-Based One Time Password (TOTP) authentication is extremely beneficial.
It lets you quickly add two‑factor authentication (2FA) to online accounts according
to a simple and open standard. Simply scan a QR code into a TOTP app like <a href="https://github.com/beemdevelopment/Aegis">Aegis</a>.
As long as you have access to your phone, you can then use the TOTP app to generate 2FA codes whenever need be.
No risk of <a href="https://en.wikipedia.org/wiki/SIM_swap_scam">SIM swapping</a>, no need for SMS reception or a phone number, and no need for proprietary 2FA apps.</p>
<p><strong>But TOTP as it&rsquo;s currently widely implemented has a shortcoming; it doesn&rsquo;t prevent phishing attacks.</strong>
Click a link in an email that redirects to a phishing website; the phishing website mimics one of your favorite websites.
You think it&rsquo;s the legitimate website, so you enter your username, password, and TOTP code.
The attacker behind the phishing website now has everything they need to sign in to the legitimate website on your behalf without your consent.
Even though you have TOTP‑based 2FA enabled, you can still be phished.</p>
<h2 id="the-problem">The Problem<a hidden class="anchor" aria-hidden="true" href="#the-problem">#</a></h2>
<p>The problem in the above scenario is that authentication is only actually being done one way.
Existing TOTP implementations allow users to authenticate to websites (think &ldquo;I&rsquo;m the website google.com, is this person really John Smith?&rdquo;).
Existing TOTP implementations <em>don&rsquo;t</em> authenticate websites to users (think &ldquo;I&rsquo;m John Smith, is this website really google.com?&rdquo;).</p>
<h2 id="bi-directional-alternative">Bi-Directional Alternative<a hidden class="anchor" aria-hidden="true" href="#bi-directional-alternative">#</a></h2>
<p>Imagine the scenario where, in addition to asking you for your TOTP code (let&rsquo;s call this <code>z</code>), a website also provided you with its own TOTP code (let&rsquo;s call this <code>z'</code>).
Within your authenticator app, you&rsquo;d select the desired website from a list of stored websites.
But rather than being shown a TOTP code right away (<code>z</code>), you&rsquo;d be prompted for the TOTP code provided from the website (<code>z'</code>).</p>
<p>If the website is a phishing website, they can&rsquo;t produce valid TOTP codes <code>z</code> or <code>z'</code>.
Your authenticator app would check that the TOTP code provided by the website (<code>z'</code>) is valid.
The legitimate website would check that the TOTP code provided by your authenticator app (<code>z</code>) is valid.</p>
<p>If the code <code>z'</code> is NOT valid, the authenticator app knows something is wrong, and would show a large error message indicating that you may be interacting with a phishing website.
At this point, you could change your password on the legitimate site and report the phishing attempt.</p>
<p>If the code <code>z'</code> is valid, the authenticator app would provide you with the usual TOTP code <code>z</code> and you would sign in as usual.
If the code <code>z'</code> is NOT valid, the authenticator app would never provide you with the TOTP code required by the legitimate website.</p>
<h2 id="bi-directional-authentication-in-the-rfc">Bi-Directional Authentication in the RFC<a hidden class="anchor" aria-hidden="true" href="#bi-directional-authentication-in-the-rfc">#</a></h2>
<p>I mused over this for long enough that I exhausted the TOTP and HOTP Wikipedia articles and went on to read the RFCs.
There are (at least) two main standards related to TOTP.
<a href="https://datatracker.ietf.org/doc/html/rfc4226">RFC 4226</a> defines a more generic HMAC‑Based OTP algorithm (HOTP).
<a href="https://datatracker.ietf.org/doc/html/rfc6238">RFC 6238</a> defines the TOTP algorithm based on the HOTP algorithm.
On page 14 of <a href="https://datatracker.ietf.org/doc/html/rfc4226">RFC 4226</a>, I found this gem:</p>
<blockquote>
<p>Interestingly enough, the HOTP client could also be used to<br>
authenticate the validation server, claiming that it is a genuine<br>
entity knowing the shared secret.</p>
<p>Since the HOTP client and the server are synchronized and share the<br>
same secret (or a method to recompute it), a simple 3-pass protocol<br>
could be put in place:<br>
1- The end user enter the TokenID and a first OTP value OTP1;<br>
2- The server checks OTP1 and if correct, sends back OTP2;<br>
3- The end user checks OTP2 using his HOTP device and if correct,<br>
uses the web site.</p>
</blockquote>
<p>In other words, the writers of the HOTP RFC considered this as a possibility but nothing (as far as I know) ever came of it.</p>
<h2 id="implementation-ideas">Implementation Ideas<a hidden class="anchor" aria-hidden="true" href="#implementation-ideas">#</a></h2>
<p>I&rsquo;ve come up with two back-of-the-envelope implementation ideas that seem like they&rsquo;d work given minimal extension of the existing RFCs.</p>
<h3 id="the-straightforward-way---generate-two-keys">The Straightforward Way - Generate Two Keys<a hidden class="anchor" aria-hidden="true" href="#the-straightforward-way---generate-two-keys">#</a></h3>
<p>The most straightforward way (in my opinion) to implement bi‑directional TOTP would be to generate two shared keys on a website for each new 2FA enrollment.
Call these keys $$k, k&rsquo;$$</p>
<ul>
<li><code>k</code> would be used for (the usual) user‑to‑website authentication</li>
<li><code>k'</code> would be used for (the new) website‑to‑user authentication</li>
</ul>
<p>One drawback to this approach is that it includes the network transmission of <code>k'</code> during enrollment.
Further, this requires storing <code>k'</code> for every 2FA enrollment, increasing storage costs.</p>
<h3 id="the-simple-way---key-derivation">The Simple(?) Way - Key Derivation<a hidden class="anchor" aria-hidden="true" href="#the-simple-way---key-derivation">#</a></h3>
<p>Rather than generate a new key <code>k'</code> just for website-to-client authentication, it could be derived from <code>K</code>.
For example, implementations could use a <a href="https://en.wikipedia.org/wiki/Key_derivation_function">key derivation function</a>
such as Argon2 or PBKDF2, taking as inputs <code>K</code> and some salt which is fixed for the protocol.</p>
<p>The biggest advantages to this approach is that it negates the need for network transmission of <code>k'</code> upon enrollment.
It also allows for finer-grained time/value tradeoffs to be made regarding when <code>k'</code> is derived and stored.
The drawback is added complexity and an increased implementation attack surface.</p>
<h2 id="conclusion">Conclusion<a hidden class="anchor" aria-hidden="true" href="#conclusion">#</a></h2>
<p>Bi‑directional authentication is only mentioned in the HOTP RFC, not the TOTP RFC.
Neither RFC 4226 nor 6238 include the word &ldquo;phishing&rdquo; and they were published in 2005 and 2011, respectively.
I would argue that, given that phishing attacks are still prevalent in 2023, we should revisit bi‑directional authentication in TOTP.
I&rsquo;d love to see a pull request to support this in one of the major open source TOTP implementations.</p>
<h2 id="appendix-accessibility">Appendix: Accessibility<a hidden class="anchor" aria-hidden="true" href="#appendix-accessibility">#</a></h2>
<p>TOTP limits accessibility by using short timeouts (30 seconds by default).
Adding a second code implies a twofold increase in the amount of time required by a user to authenticate to a service.
Further, TOTP codes aren&rsquo;t intuitive to a non-technical audience. In my opinion, this is evidenced by a lack of wider adoption. Adding a second code to the mix only increases the potential for confusion.</p>
<p>I understand the absence of a widely-implemented bi-directional TOTP standard in light of these constraints.</p>
<h2 id="appendix-phishing-vs-totp-timeouts">Appendix: Phishing vs TOTP Timeouts<a hidden class="anchor" aria-hidden="true" href="#appendix-phishing-vs-totp-timeouts">#</a></h2>
<p>Technically, because TOTP codes expire (by default) in 30 seconds,
any phishing attack would have to prompt the user for their TOTP code, receive the response, and have it accepted by the legitimate website
on behalf of the attacker within 30 seconds.</p>
<p>In practice, I don&rsquo;t see this as a limiting factor in most phishing attacks.
Also, specific TOTP code expiration times are an implementation detail;
I don&rsquo;t think they should be relied upon to prevent phishing attacks.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://juniperspring.xyz/tags/mfa/">mfa</a></li>
      <li><a href="https://juniperspring.xyz/tags/security/">security</a></li>
      <li><a href="https://juniperspring.xyz/tags/totp/">totp</a></li>
      <li><a href="https://juniperspring.xyz/tags/cryptography/">cryptography</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://juniperspring.xyz/posts/rhodes-tower/">
    <span class="title">« Prev</span>
    <br>
    <span>Rhodes Tower, Four Dead in Ohio</span>
  </a>
  <a class="next" href="https://juniperspring.xyz/posts/digital-organization/">
    <span class="title">Next »</span>
    <br>
    <span>Digital Organization</span>
  </a>
</nav>


<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share Bi-Directional Authentication with TOTP on twitter"
        href="https://twitter.com/intent/tweet/?text=Bi-Directional%20Authentication%20with%20TOTP&amp;url=https%3a%2f%2fjuniperspring.xyz%2fposts%2fbidirectional-totp%2f&amp;hashtags=mfa%2csecurity%2ctotp%2ccryptography">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Bi-Directional Authentication with TOTP on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fjuniperspring.xyz%2fposts%2fbidirectional-totp%2f&amp;title=Bi-Directional%20Authentication%20with%20TOTP&amp;summary=Bi-Directional%20Authentication%20with%20TOTP&amp;source=https%3a%2f%2fjuniperspring.xyz%2fposts%2fbidirectional-totp%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Bi-Directional Authentication with TOTP on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2fjuniperspring.xyz%2fposts%2fbidirectional-totp%2f&title=Bi-Directional%20Authentication%20with%20TOTP">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Bi-Directional Authentication with TOTP on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fjuniperspring.xyz%2fposts%2fbidirectional-totp%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Bi-Directional Authentication with TOTP on whatsapp"
        href="https://api.whatsapp.com/send?text=Bi-Directional%20Authentication%20with%20TOTP%20-%20https%3a%2f%2fjuniperspring.xyz%2fposts%2fbidirectional-totp%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Bi-Directional Authentication with TOTP on telegram"
        href="https://telegram.me/share/url?text=Bi-Directional%20Authentication%20with%20TOTP&amp;url=https%3a%2f%2fjuniperspring.xyz%2fposts%2fbidirectional-totp%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="https://juniperspring.xyz">Juniperspring</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
