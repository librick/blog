<!DOCTYPE html>






























<html
  class="not-ready text-sm lg:text-base"
  style="--bg: #faf6f1"
  lang="en-us"
>
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, shrink-to-fit=no"
  />

  
  <title>SSH Comment Injection in OpenWRT - Juniperspring</title>

  
  <meta name="theme-color" />

  
  
  
  <meta name="description" content="OpenWRT is open source router and Wi-Fi access point software. LuCI is the web-based configuration interface for OpenWRT; one of its features is the ability to import SSH keys. Instead of OpenSSH, OpenWRT uses Dropbear, an SSH server implementation optimized for embedded systems1.
OpenSSH 8.2, released Feb. 14th, 2020, added support for new FIDO public key types, such as &ldquo;ecdsa-sk&rdquo; and &ldquo;ed25519-sk&rdquo;2. I wanted to see if Dropbear supported these new key types." />
  <meta name="author" content="Eric McDonald" />
  

  
  
  
  
  
  
  <link rel="preload stylesheet" as="style" href="https://juniperspring.xyz/main.min.css" />

  
  <script
    defer
    src="https://juniperspring.xyz/highlight.min.js"
    onload="hljs.initHighlightingOnLoad();"
  ></script>
  

  
   
  <link rel="preload" as="image" href="https://juniperspring.xyz/theme.png" />

  
  
  
  

  
  <link rel="preload" as="image" href="https://juniperspring.xyz/github.svg" />
  
  <link rel="preload" as="image" href="https://juniperspring.xyz/rss.svg" />
  
  

  
  
  <link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css"
  integrity="sha384-3UiQGuEI4TTMaFmGIZumfRPtfKQ3trwQE2JgosJxCnGmQpL/lJdjpcHkaaFwHlcI"
  crossorigin="anonymous"
/>
<script
  defer
  src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js"
  integrity="sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t"
  crossorigin="anonymous"
></script>
<script
  defer
  src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js"
  integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05"
  crossorigin="anonymous"
  onload="renderMathInElement(document.body);"
></script>

  
  
  

  
  <link rel="icon" href="https://juniperspring.xyz/favicon.ico" />
  <link rel="apple-touch-icon" href="https://juniperspring.xyz/apple-touch-icon.png" />

  
  <meta name="generator" content="Hugo 0.112.0">

  
  

  
  
  
  
  
  
  
  <meta property="og:title" content="SSH Comment Injection in OpenWRT" />
<meta property="og:description" content="OpenWRT is open source router and Wi-Fi access point software. LuCI is the web-based configuration interface for OpenWRT; one of its features is the ability to import SSH keys. Instead of OpenSSH, OpenWRT uses Dropbear, an SSH server implementation optimized for embedded systems1.
OpenSSH 8.2, released Feb. 14th, 2020, added support for new FIDO public key types, such as &ldquo;ecdsa-sk&rdquo; and &ldquo;ed25519-sk&rdquo;2. I wanted to see if Dropbear supported these new key types." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://juniperspring.xyz/posts/ssh-comment-injection/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-20T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-09-20T00:00:00+00:00" />

  
  <meta itemprop="name" content="SSH Comment Injection in OpenWRT">
<meta itemprop="description" content="OpenWRT is open source router and Wi-Fi access point software. LuCI is the web-based configuration interface for OpenWRT; one of its features is the ability to import SSH keys. Instead of OpenSSH, OpenWRT uses Dropbear, an SSH server implementation optimized for embedded systems1.
OpenSSH 8.2, released Feb. 14th, 2020, added support for new FIDO public key types, such as &ldquo;ecdsa-sk&rdquo; and &ldquo;ed25519-sk&rdquo;2. I wanted to see if Dropbear supported these new key types."><meta itemprop="datePublished" content="2022-09-20T00:00:00+00:00" />
<meta itemprop="dateModified" content="2022-09-20T00:00:00+00:00" />
<meta itemprop="wordCount" content="328">
<meta itemprop="keywords" content="security,ssh,openwrt,dropbear,openssh,fido,cryptography," />
  
  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="SSH Comment Injection in OpenWRT"/>
<meta name="twitter:description" content="OpenWRT is open source router and Wi-Fi access point software. LuCI is the web-based configuration interface for OpenWRT; one of its features is the ability to import SSH keys. Instead of OpenSSH, OpenWRT uses Dropbear, an SSH server implementation optimized for embedded systems1.
OpenSSH 8.2, released Feb. 14th, 2020, added support for new FIDO public key types, such as &ldquo;ecdsa-sk&rdquo; and &ldquo;ed25519-sk&rdquo;2. I wanted to see if Dropbear supported these new key types."/>

  
  
</head>

  <body class="text-black duration-200 ease-out dark:text-white">
    <header class="mx-auto flex h-[5rem] max-w-3xl px-8 lg:justify-center">
  <div class="relative z-50 mr-auto flex items-center">
    <a
      class="-translate-x-[1px] -translate-y-0.5 text-3xl font-bold site-title"
      href="https://juniperspring.xyz/"
      >Juniperspringüå±</a
    >
    <div
      class="btn-dark text-[0] ml-6 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.png)_left_center/_auto_theme('spacing.6')_no-repeat] [transition:_background-position_0.4s_steps(5)] dark:[background-position:right]"
      role="button"
      aria-label="Dark"
    ></div>
  </div>

  <div
    class="btn-menu relative z-50 -mr-8 flex h-[5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden"
    role="button"
    aria-label="Menu"
  ></div>

  
  <script>
    
    const htmlClass = document.documentElement.classList;
    setTimeout(() => {
      htmlClass.remove('not-ready');
    }, 10);

    
    const btnMenu = document.querySelector('.btn-menu');
    btnMenu.addEventListener('click', () => {
      htmlClass.toggle('open');
    });

    
    const metaTheme = document.querySelector('meta[name="theme-color"]');
    const lightBg = `"#faf6f1"`.replace(/"/g, '');
    const setDark = (isDark) => {
      metaTheme.setAttribute('content', isDark ? '#000' : lightBg);
      htmlClass[isDark ? 'add' : 'remove']('dark');
      localStorage.setItem('dark', isDark);
    };

    
    const darkScheme = window.matchMedia('(prefers-color-scheme: dark)');
    if (htmlClass.contains('dark')) {
      setDark(true);
    } else {
      const darkVal = localStorage.getItem('dark');
      setDark(darkVal ? darkVal === 'true' : darkScheme.matches);
    }

    
    darkScheme.addEventListener('change', (event) => {
      setDark(event.matches);
    });

    
    const btnDark = document.querySelector('.btn-dark');
    btnDark.addEventListener('click', () => {
      setDark(localStorage.getItem('dark') !== 'true');
    });
  </script>

  <div
    class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full select-none flex-col justify-center pb-16 duration-200 dark:bg-black lg:static lg:h-auto lg:flex-row lg:!bg-transparent lg:pb-0 lg:transition-none"
  >
    
    

    
    <nav
      class="mt-12 flex justify-center space-x-10 dark:invert lg:ml-12 lg:mt-0 lg:items-center lg:space-x-6"
    >
      
      <a
        class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./github.svg)"
        href="https://github.com/librick"
        target="_blank"
        rel="me"
      >
        github
      </a>
      
      <a
        class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./rss.svg)"
        href="https://juniperspring.xyz/index.xml"
        target="_blank"
        rel="alternate"
      >
        rss
      </a>
      
    </nav>
    
  </div>
</header>


    <main
      class="prose prose-neutral relative mx-auto min-h-[calc(100%-10rem)] max-w-3xl px-8 pb-24 pt-16 dark:prose-invert"
    >
      

<article>
  <header class="mb-20">
    <h1 class="!my-0 pb-2.5">SSH Comment Injection in OpenWRT</h1>

    
    <div class="text-sm opacity-60">
      
      <time>Sep 20, 2022</time>
      
      
      
      
    </div>
    
  </header>

  <section><p><img src="linksys_wrt3200acm_board_top_complete.jpg" alt="WRT3200ACM router motherboard" title="WRT3200ACM router motherboard"></p>
<p>OpenWRT is open source router and Wi-Fi access point software. LuCI is the web-based configuration interface for OpenWRT; one of its features is the ability to import SSH keys. Instead of OpenSSH, OpenWRT uses Dropbear, an SSH server implementation optimized for embedded systems<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>.</p>
<p>OpenSSH 8.2, released Feb. 14th, 2020, added support for new FIDO public key types, such as &ldquo;ecdsa-sk&rdquo; and &ldquo;ed25519-sk&rdquo;<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>. I wanted to see if Dropbear supported these new key types. It was during this time that I discovered a persistent XSS vector in LuCI.</p>
<p>At the time of publication, OpenWRT LuCI failed to properly sanitize OpenSSH public key comments.
By specifying markdown in the place of an SSH key comment, you could embed scripts within LuCI,
which would be executed upon navigation to the <code>System -&gt; Administration</code> settings page.</p>
<p>I emailed Jon from the OpenWRT team; they pushed a patch the next day<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup><sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup>.
After getting written permission from the OpenWRT (via email), I filed for a CVE.
I was assigned CVE-2022-41435<sup id="fnref:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">5</a></sup><sup id="fnref:6"><a href="#fn:6" class="footnote-ref" role="doc-noteref">6</a></sup><sup id="fnref:7"><a href="#fn:7" class="footnote-ref" role="doc-noteref">7</a></sup>.</p>
<p>SSH comment injection presents a unique attack vector; it has nothing to do with the security of assymetric crypto or the SSH protocol. But it is a source of user-provided input that should be untrusted and properly sanitized.</p>
<p>Thanks to the OpenWRT team for the quick response time, and thanks for contributing to open source ‚ù§Ô∏èüì°</p>
<p>References</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>Dropbear (Nov 14, 2022). <a href="https://web.archive.org/web/20230530151641/https://matt.ucc.asn.au/dropbear/dropbear.html">&ldquo;Dropbear homepage&rdquo;</a>. Dropbear. <a href="">Archived</a> from the original on May 30, 2023. Retrieved May 30, 2023.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>OpenSSH (Feb 14, 2020). <a href="https://www.openssh.com/txt/release-8.2">&ldquo;OpenSSH 8.2 release notes&rdquo;</a>. OpenSSH. <a href="https://web.archive.org/web/20230530150006/https://www.openssh.com/txt/release-8.2">Archived</a> from the original on May 30, 2023. Retrieved May 30, 2023.&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>OpenWRT (May 02, 2023). <a href="https://openwrt.org/docs/guide-developer/security#vulnerability_reporting">&ldquo;OpenWRT developer guide, security, vulnerability reporting&rdquo;</a>. OpenWRT. Retrieved May 30, 2023.&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4">
<p>GitHub. <a href="https://github.com/openwrt/luci/commit/944b55738e7f9685865d5298248b7fbd7380749e">&ldquo;OpenWRT LuCI commit: luci-mod-system: sshkeys.js: prevent XSS through pubkey comments&rdquo;</a>.&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:5">
<p>MITRE (Sep 26, 2022). <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-41435">&ldquo;MITRE CVE-2022-41435&rdquo;</a>. <a href="https://web.archive.org/web/20230530152700/https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-41435">Archived</a> from the original on May 30, 2023. Retrieved May 30, 2023.&#160;<a href="#fnref:5" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:6">
<p>NIST (Nov 04, 2022). <a href="https://nvd.nist.gov/vuln/detail/CVE-2022-41435">&ldquo;NIST CVE-2022-41435&rdquo;</a>.&#160;<a href="#fnref:6" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:7">
<p>GitHub. <a href="https://gist.github.com/librick/eacf19bcfc5ca964e0882b4ef9864bf5">&ldquo;librick gist, CVE-2022-41435&rdquo;</a>. GitHub. <a href="https://web.archive.org/web/20230530152019/https://gist.github.com/librick/eacf19bcfc5ca964e0882b4ef9864bf5">Archived</a> from the original on May 30, 2023. Retrieved May 30, 2023.&#160;<a href="#fnref:7" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
</section>

  
  
  <footer class="mt-12 flex flex-wrap">
     
    <a
      class="mb-1.5 mr-1.5 rounded-lg bg-black/[3%] px-5 py-2 no-underline dark:bg-white/[8%]"
      href="https://juniperspring.xyz/tags/security"
      >security</a
    >
     
    <a
      class="mb-1.5 mr-1.5 rounded-lg bg-black/[3%] px-5 py-2 no-underline dark:bg-white/[8%]"
      href="https://juniperspring.xyz/tags/ssh"
      >ssh</a
    >
     
    <a
      class="mb-1.5 mr-1.5 rounded-lg bg-black/[3%] px-5 py-2 no-underline dark:bg-white/[8%]"
      href="https://juniperspring.xyz/tags/openwrt"
      >openwrt</a
    >
     
    <a
      class="mb-1.5 mr-1.5 rounded-lg bg-black/[3%] px-5 py-2 no-underline dark:bg-white/[8%]"
      href="https://juniperspring.xyz/tags/dropbear"
      >dropbear</a
    >
     
    <a
      class="mb-1.5 mr-1.5 rounded-lg bg-black/[3%] px-5 py-2 no-underline dark:bg-white/[8%]"
      href="https://juniperspring.xyz/tags/openssh"
      >openssh</a
    >
     
    <a
      class="mb-1.5 mr-1.5 rounded-lg bg-black/[3%] px-5 py-2 no-underline dark:bg-white/[8%]"
      href="https://juniperspring.xyz/tags/fido"
      >fido</a
    >
     
    <a
      class="mb-1.5 mr-1.5 rounded-lg bg-black/[3%] px-5 py-2 no-underline dark:bg-white/[8%]"
      href="https://juniperspring.xyz/tags/cryptography"
      >cryptography</a
    >
    
  </footer>
  

  
  
  
  <nav class="mt-24 flex rounded-lg bg-black/[3%] text-lg dark:bg-white/[8%]">
    
    <a
      class="flex w-1/2 items-center rounded-l-md p-6 pr-3 no-underline hover:bg-black/[2%] dark:hover:bg-white/[3%]"
      href="https://juniperspring.xyz/posts/locked-out-of-keybase/"
      ><span class="mr-1.5">‚Üê</span><span>Locked out of Keybase</span></a
    >
    
    
    <a
      class="ml-auto flex w-1/2 items-center justify-end rounded-r-md p-6 pl-3 no-underline hover:bg-black/[2%] dark:hover:bg-white/[3%]"
      href="https://juniperspring.xyz/posts/auto-insurance-discrimination/"
      ><span>Auto Insurance Discrimination in Ohio</span><span class="ml-1.5">‚Üí</span></a
    >
    
  </nav>
  

  
  

  
  
</article>


    </main>

    <footer class="mx-auto flex-col h-[5rem] max-w-3xl px-8 text-[0.9em] opacity-60">
  <div>You got a sweet voice, child / Why don't you use it? - Morby</div>
  <div class="mr-auto">
    &copy; 2023,
    <a class="link" href="https://juniperspring.xyz">MIT License</a>
  </div>
</footer>

  </body>
</html>
